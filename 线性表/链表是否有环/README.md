### 如何判断单链表是否有环

设环长为 n，初始时指针 P 和 Q 指向环上的同一个节点。P 每次前进 1 步，Q 每次前进 2 步，则 P 和 Q 下次相遇时：

* P 走了 i 步，Q 走了 2 &times; i 步

* i mod n = 2 &times; i mod n（i 和 2 &times; i 模 n 同余）  
即当 i = n 时，P 和 Q 第一次相遇，相遇点是出发点

假设 P 落后 Q k 步（因为在环上，因此相当于 P 领先 Q n \- k 步），P 每次前进 1 步，Q 每次前进 2 步，则 P 和 Q 相遇时：

* P 走了 i 步，Q 走了 2 &times; i 步

* i mod n = (2 &times; i + k) mod n（i 和 2 &times; i + k 模 n 同余）  
即当 i = n \- k 时，P 和 Q 第一次相遇

综上所述，**无论初始时 P 和 Q 指向哪里，只要一个每次前进 1 步，另一个每次前进 2 步，最终都会相遇，并且下次再相遇时，慢指针正好走一圈，快指针正好走两圈**。

---

### 求连接点

![cycle.png](http://images.timd.cn/data-structure/cycle.png)

设链表的第一个节点到连接点的长度是 l，连接点到第一次相遇的节点的长度是 x，则第一次相遇时：

慢指针走了 l + x 步，快指针走了 l + x + n &times; R，并且快指针走的步数是慢指针的两倍，所以：

2(l + x) = l + x + nR ===&gt;

l + x = n &times; R ===&gt;

l = (n \- x) + n &times; (R \- 1)

**综上所述，从第一个节点到连接点的距离等于第一次相遇的点到连接点的距离 再加上若干圈。**

因此，一个指针从相遇点出发，一个指针从第一个节点出发，最终它们会在连接点相遇。
